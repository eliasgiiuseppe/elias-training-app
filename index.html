<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Climbing Training Tracker</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/lucide-react@0.263.1/dist/lucide-react.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #111827;
            color: white;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow-x: hidden;
            -webkit-user-select: none;
            user-select: none;
        }
        
        /* iOS specific styles */
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }
        
        input, button, select, textarea {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1f2937;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 3px;
        }
        
        /* Prevent overscroll bounce */
        html, body {
            position: fixed;
            overflow: hidden;
            width: 100%;
            height: 100%;
        }
        
        #root {
            height: 100%;
            overflow: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        /* Animation classes */
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Custom button press effect */
        button:active {
            transform: scale(0.98);
        }
        
        /* Timer display */
        .timer-display {
            font-variant-numeric: tabular-nums;
            font-feature-settings: "tnum";
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // Icons as React components
        const ChevronRight = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="9 18 15 12 9 6"></polyline></svg>;
        const Plus = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>;
        const Edit2 = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>;
        const Trash2 = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>;
        const Play = ({ size = 24 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>;
        const Pause = ({ size = 24 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>;
        const RotateCcw = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="1 4 1 10 7 10"></polyline><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path></svg>;
        const Check = ({ size = 24 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="20 6 9 17 4 12"></polyline></svg>;
        const X = ({ size = 24 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>;
        const Menu = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>;
        const Dumbbell = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M6.5 6.5a2 2 0 0 1 2-2h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-11z"></path><path d="M12.5 6.5a2 2 0 0 1 2-2h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-11z"></path><path d="M6.5 12h11"></path></svg>;
        const Calendar = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>;
        const BarChart = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="20" x2="12" y2="10"></line><line x1="18" y1="20" x2="18" y2="4"></line><line x1="6" y1="20" x2="6" y2="16"></line></svg>;
        const Settings = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="3"></circle><path d="M12 1v6m0 6v6m4.22-10.22l4.24 4.24M6.34 6.34L2.1 2.1m17.8 17.8l-4.24-4.24M6.34 17.66L2.1 21.9"></path></svg>;
        const ArrowLeft = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>;
        const RefreshCw = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>;
        
        // Utility functions
        const generateId = () => Date.now().toString(36) + Math.random().toString(36).substr(2);
        
        // Default training types
        const DEFAULT_TRAINING_TYPES = [
            'Strength',
            'Power', 
            'Projecting',
            'Power Endurance',
            'Endurance'
        ];
        
        // Main App Component
        const App = () => {
            // State management
            const [exercises, setExercises] = useState([]);
            const [sessions, setSessions] = useState([]);
            const [trainingPlan, setTrainingPlan] = useState([]);
            const [trainingTypes, setTrainingTypes] = useState(DEFAULT_TRAINING_TYPES);
            const [currentView, setCurrentView] = useState('home');
            const [activeSession, setActiveSession] = useState(null);
            const [activeExercise, setActiveExercise] = useState(null);
            const [sessionHistory, setSessionHistory] = useState([]);
            
            // Load data from localStorage
            useEffect(() => {
                const savedExercises = localStorage.getItem('exercises');
                const savedSessions = localStorage.getItem('sessions');
                const savedPlan = localStorage.getItem('trainingPlan');
                const savedTypes = localStorage.getItem('trainingTypes');
                const savedHistory = localStorage.getItem('sessionHistory');
                
                if (savedExercises) setExercises(JSON.parse(savedExercises));
                if (savedSessions) setSessions(JSON.parse(savedSessions));
                if (savedPlan) setTrainingPlan(JSON.parse(savedPlan));
                if (savedTypes) setTrainingTypes(JSON.parse(savedTypes));
                if (savedHistory) setSessionHistory(JSON.parse(savedHistory));
            }, []);
            
            // Save data to localStorage
            useEffect(() => {
                localStorage.setItem('exercises', JSON.stringify(exercises));
            }, [exercises]);
            
            useEffect(() => {
                localStorage.setItem('sessions', JSON.stringify(sessions));
            }, [sessions]);
            
            useEffect(() => {
                localStorage.setItem('trainingPlan', JSON.stringify(trainingPlan));
            }, [trainingPlan]);
            
            useEffect(() => {
                localStorage.setItem('trainingTypes', JSON.stringify(trainingTypes));
            }, [trainingTypes]);
            
            useEffect(() => {
                localStorage.setItem('sessionHistory', JSON.stringify(sessionHistory));
            }, [sessionHistory]);
            
            // Navigation component
            const Navigation = () => (
                <div className="fixed bottom-0 left-0 right-0 bg-gray-800 border-t border-gray-700 z-50">
                    <div className="flex justify-around py-2">
                        <button
                            onClick={() => setCurrentView('home')}
                            className={`flex flex-col items-center p-2 transition-colors ${currentView === 'home' ? 'text-blue-400' : 'text-gray-400'}`}
                        >
                            <Menu />
                            <span className="text-xs mt-1">Home</span>
                        </button>
                        <button
                            onClick={() => setCurrentView('exercises')}
                            className={`flex flex-col items-center p-2 transition-colors ${currentView === 'exercises' ? 'text-blue-400' : 'text-gray-400'}`}
                        >
                            <Dumbbell />
                            <span className="text-xs mt-1">Übungen</span>
                        </button>
                        <button
                            onClick={() => setCurrentView('sessions')}
                            className={`flex flex-col items-center p-2 transition-colors ${currentView === 'sessions' ? 'text-blue-400' : 'text-gray-400'}`}
                        >
                            <Calendar />
                            <span className="text-xs mt-1">Einheiten</span>
                        </button>
                        <button
                            onClick={() => setCurrentView('plan')}
                            className={`flex flex-col items-center p-2 transition-colors ${currentView === 'plan' ? 'text-blue-400' : 'text-gray-400'}`}
                        >
                            <BarChart />
                            <span className="text-xs mt-1">Plan</span>
                        </button>
                        <button
                            onClick={() => setCurrentView('settings')}
                            className={`flex flex-col items-center p-2 transition-colors ${currentView === 'settings' ? 'text-blue-400' : 'text-gray-400'}`}
                        >
                            <Settings />
                            <span className="text-xs mt-1">Settings</span>
                        </button>
                    </div>
                </div>
            );
            
            // Exercise Form Component
            const ExerciseForm = ({ exercise, onSave, onCancel }) => {
                const [name, setName] = useState(exercise?.name || '');
                const [type, setType] = useState(exercise?.type || 'reps');
                const [sets, setSets] = useState(exercise?.sets || 3);
                const [repsOrTime, setRepsOrTime] = useState(exercise?.repsOrTime || 10);
                const [restTime, setRestTime] = useState(exercise?.restTime || 60);
                
                const handleSubmit = (e) => {
                    e.preventDefault();
                    onSave({
                        id: exercise?.id || generateId(),
                        name,
                        type,
                        sets,
                        repsOrTime,
                        restTime
                    });
                };
                
                return (
                    <form onSubmit={handleSubmit} className="space-y-4 fade-in">
                        <input
                            type="text"
                            placeholder="Übungsname"
                            value={name}
                            onChange={(e) => setName(e.target.value)}
                            className="w-full p-3 bg-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                            required
                        />
                        
                        <div className="flex gap-2">
                            <button
                                type="button"
                                onClick={() => setType('reps')}
                                className={`flex-1 p-3 rounded-lg transition-colors ${type === 'reps' ? 'bg-blue-600' : 'bg-gray-700'}`}
                            >
                                Wiederholungen
                            </button>
                            <button
                                type="button"
                                onClick={() => setType('time')}
                                className={`flex-1 p-3 rounded-lg transition-colors ${type === 'time' ? 'bg-blue-600' : 'bg-gray-700'}`}
                            >
                                Zeit
                            </button>
                        </div>
                        
                        <div className="grid grid-cols-3 gap-2">
                            <div>
                                <label className="text-sm text-gray-400">Sätze</label>
                                <input
                                    type="number"
                                    value={sets}
                                    onChange={(e) => setSets(parseInt(e.target.value))}
                                    className="w-full p-3 bg-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    min="1"
                                    required
                                />
                            </div>
                            <div>
                                <label className="text-sm text-gray-400">{type === 'reps' ? 'Wiederholungen' : 'Sekunden'}</label>
                                <input
                                    type="number"
                                    value={repsOrTime}
                                    onChange={(e) => setRepsOrTime(parseInt(e.target.value))}
                                    className="w-full p-3 bg-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    min="1"
                                    required
                                />
                            </div>
                            <div>
                                <label className="text-sm text-gray-400">Pause (s)</label>
                                <input
                                    type="number"
                                    value={restTime}
                                    onChange={(e) => setRestTime(parseInt(e.target.value))}
                                    className="w-full p-3 bg-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    min="0"
                                    required
                                />
                            </div>
                        </div>
                        
                        <div className="flex gap-2">
                            <button
                                type="submit"
                                className="flex-1 bg-blue-600 p-3 rounded-lg font-medium transition-opacity active:opacity-80"
                            >
                                Speichern
                            </button>
                            <button
                                type="button"
                                onClick={onCancel}
                                className="flex-1 bg-gray-700 p-3 rounded-lg font-medium transition-opacity active:opacity-80"
                            >
                                Abbrechen
                            </button>
                        </div>
                    </form>
                );
            };
            
            // Exercises View
            const ExercisesView = () => {
                const [showForm, setShowForm] = useState(false);
                const [editingExercise, setEditingExercise] = useState(null);
                
                const handleSave = (exercise) => {
                    if (editingExercise) {
                        setExercises(exercises.map(e => e.id === exercise.id ? exercise : e));
                    } else {
                        setExercises([...exercises, exercise]);
                    }
                    setShowForm(false);
                    setEditingExercise(null);
                };
                
                const handleDelete = (id) => {
                    if (confirm('Übung wirklich löschen?')) {
                        setExercises(exercises.filter(e => e.id !== id));
                    }
                };
                
                return (
                    <div className="pb-20">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold">Übungen</h2>
                            <button
                                onClick={() => setShowForm(true)}
                                className="bg-blue-600 p-2 rounded-lg transition-opacity active:opacity-80"
                            >
                                <Plus />
                            </button>
                        </div>
                        
                        {showForm && (
                            <div className="mb-6 bg-gray-800 p-4 rounded-lg">
                                <ExerciseForm
                                    exercise={editingExercise}
                                    onSave={handleSave}
                                    onCancel={() => {
                                        setShowForm(false);
                                        setEditingExercise(null);
                                    }}
                                />
                            </div>
                        )}
                        
                        <div className="space-y-2">
                            {exercises.map(exercise => (
                                <div key={exercise.id} className="bg-gray-800 p-4 rounded-lg flex justify-between items-center fade-in">
                                    <div>
                                        <h3 className="font-medium">{exercise.name}</h3>
                                        <p className="text-sm text-gray-400">
                                            {exercise.sets} × {exercise.repsOrTime} {exercise.type === 'reps' ? 'Wdh' : 'Sek'} • {exercise.restTime}s Pause
                                        </p>
                                    </div>
                                    <div className="flex gap-2">
                                        <button
                                            onClick={() => {
                                                setEditingExercise(exercise);
                                                setShowForm(true);
                                            }}
                                            className="text-blue-400 transition-opacity active:opacity-60"
                                        >
                                            <Edit2 />
                                        </button>
                                        <button
                                            onClick={() => handleDelete(exercise.id)}
                                            className="text-red-400 transition-opacity active:opacity-60"
                                        >
                                            <Trash2 />
                                        </button>
                                    </div>
                                </div>
                            ))}
                            
                            {exercises.length === 0 && (
                                <p className="text-center text-gray-400 py-8">Noch keine Übungen erstellt</p>
                            )}
                        </div>
                    </div>
                );
            };
            
            // Session Form Component
            const SessionForm = ({ session, onSave, onCancel }) => {
                const [name, setName] = useState(session?.name || '');
                const [trainingType, setTrainingType] = useState(session?.trainingType || trainingTypes[0]);
                const [selectedExercises, setSelectedExercises] = useState(session?.exercises || []);
                
                const handleSubmit = (e) => {
                    e.preventDefault();
                    onSave({
                        id: session?.id || generateId(),
                        name,
                        trainingType,
                        exercises: selectedExercises
                    });
                };
                
                const toggleExercise = (exerciseId) => {
                    if (selectedExercises.includes(exerciseId)) {
                        setSelectedExercises(selectedExercises.filter(id => id !== exerciseId));
                    } else {
                        setSelectedExercises([...selectedExercises, exerciseId]);
                    }
                };
                
                return (
                    <form onSubmit={handleSubmit} className="space-y-4 fade-in">
                        <input
                            type="text"
                            placeholder="Name der Trainingseinheit"
                            value={name}
                            onChange={(e) => setName(e.target.value)}
                            className="w-full p-3 bg-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                            required
                        />
                        
                        <select
                            value={trainingType}
                            onChange={(e) => setTrainingType(e.target.value)}
                            className="w-full p-3 bg-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                        >
                            {trainingTypes.map(type => (
                                <option key={type} value={type}>{type}</option>
                            ))}
                        </select>
                        
                        <div className="space-y-2">
                            <p className="text-sm text-gray-400">Übungen auswählen:</p>
                            {exercises.map(exercise => (
                                <label key={exercise.id} className="flex items-center p-3 bg-gray-700 rounded-lg cursor-pointer transition-colors hover:bg-gray-600">
                                    <input
                                        type="checkbox"
                                        checked={selectedExercises.includes(exercise.id)}
                                        onChange={() => toggleExercise(exercise.id)}
                                        className="mr-3 w-5 h-5 rounded text-blue-600"
                                    />
                                    <span>{exercise.name}</span>
                                </label>
                            ))}
                            
                            {exercises.length === 0 && (
                                <p className="text-center text-gray-500 py-4">Erstelle zuerst Übungen</p>
                            )}
                        </div>
                        
                        <div className="flex gap-2">
                            <button
                                type="submit"
                                className="flex-1 bg-blue-600 p-3 rounded-lg font-medium transition-opacity active:opacity-80"
                                disabled={selectedExercises.length === 0}
                            >
                                Speichern
                            </button>
                            <button
                                type="button"
                                onClick={onCancel}
                                className="flex-1 bg-gray-700 p-3 rounded-lg font-medium transition-opacity active:opacity-80"
                            >
                                Abbrechen
                            </button>
                        </div>
                    </form>
                );
            };
            
            // Sessions View
            const SessionsView = () => {
                const [showForm, setShowForm] = useState(false);
                const [editingSession, setEditingSession] = useState(null);
                
                const handleSave = (session) => {
                    if (editingSession) {
                        setSessions(sessions.map(s => s.id === session.id ? session : s));
                    } else {
                        setSessions([...sessions, session]);
                    }
                    setShowForm(false);
                    setEditingSession(null);
                };
                
                const handleDelete = (id) => {
                    if (confirm('Trainingseinheit wirklich löschen?')) {
                        setSessions(sessions.filter(s => s.id !== id));
                        setTrainingPlan(trainingPlan.filter(sid => sid !== id));
                    }
                };
                
                return (
                    <div className="pb-20">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold">Trainingseinheiten</h2>
                            <button
                                onClick={() => setShowForm(true)}
                                className="bg-blue-600 p-2 rounded-lg transition-opacity active:opacity-80"
                                disabled={exercises.length === 0}
                            >
                                <Plus />
                            </button>
                        </div>
                        
                        {showForm && (
                            <div className="mb-6 bg-gray-800 p-4 rounded-lg">
                                <SessionForm
                                    session={editingSession}
                                    onSave={handleSave}
                                    onCancel={() => {
                                        setShowForm(false);
                                        setEditingSession(null);
                                    }}
                                />
                            </div>
                        )}
                        
                        <div className="space-y-2">
                            {sessions.map(session => (
                                <div key={session.id} className="bg-gray-800 p-4 rounded-lg fade-in">
                                    <div className="flex justify-between items-center">
                                        <div>
                                            <h3 className="font-medium">{session.name}</h3>
                                            <p className="text-sm text-gray-400">{session.trainingType} • {session.exercises.length} Übungen</p>
                                        </div>
                                        <div className="flex gap-2">
                                            <button
                                                onClick={() => {
                                                    setEditingSession(session);
                                                    setShowForm(true);
                                                }}
                                                className="text-blue-400 transition-opacity active:opacity-60"
                                            >
                                                <Edit2 />
                                            </button>
                                            <button
                                                onClick={() => handleDelete(session.id)}
                                                className="text-red-400 transition-opacity active:opacity-60"
                                            >
                                                <Trash2 />
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            ))}
                            
                            {sessions.length === 0 && (
                                <p className="text-center text-gray-400 py-8">Noch keine Trainingseinheiten erstellt</p>
                            )}
                        </div>
                    </div>
                );
            };
            
            // Timer Component
            const Timer = ({ duration, onComplete }) => {
                const [timeLeft, setTimeLeft] = useState(duration);
                const [isRunning, setIsRunning] = useState(false);
                
                useEffect(() => {
                    let interval;
                    if (isRunning && timeLeft > 0) {
                        interval = setInterval(() => {
                            setTimeLeft(t => {
                                if (t <= 1) {
                                    setIsRunning(false);
                                    onComplete();
                                    return duration;
                                }
                                return t - 1;
                            });
                        }, 1000);
                    }
                    return () => clearInterval(interval);
                }, [isRunning, timeLeft, duration, onComplete]);
                
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                
                return (
                    <div className="text-center">
                        <div className="text-6xl font-mono mb-4 timer-display">
                            {minutes}:{seconds.toString().padStart(2, '0')}
                        </div>
                        <div className="flex gap-4 justify-center">
                            <button
                                onClick={() => setIsRunning(!isRunning)}
                                className="bg-blue-600 p-4 rounded-full transition-opacity active:opacity-80"
                            >
                                {isRunning ? <Pause size={24} /> : <Play size={24} />}
                            </button>
                            <button
                                onClick={() => {
                                    setIsRunning(false);
                                    setTimeLeft(duration);
                                }}
                                className="bg-gray-700 p-4 rounded-full transition-opacity active:opacity-80"
                            >
                                <RotateCcw />
                            </button>
                        </div>
                    </div>
                );
            };
            
            // Exercise Execution View
            const ExerciseExecution = ({ exercise, onComplete, onBack }) => {
                const [currentSet, setCurrentSet] = useState(1);
                const [isResting, setIsResting] = useState(false);
                const [difficulty, setDifficulty] = useState(null);
                const [timeLeft, setTimeLeft] = useState(exercise.type === 'time' ? exercise.repsOrTime : 0);
                const [isTimerRunning, setIsTimerRunning] = useState(false);
                
                useEffect(() => {
                    let interval;
                    if (isTimerRunning && timeLeft > 0) {
                        interval = setInterval(() => {
                            setTimeLeft(t => t - 1);
                        }, 1000);
                    } else if (timeLeft === 0 && isTimerRunning) {
                        setIsTimerRunning(false);
                        handleSetComplete();
                    }
                    return () => clearInterval(interval);
                }, [isTimerRunning, timeLeft]);
                
                const handleSetComplete = () => {
                    if (currentSet < exercise.sets) {
                        setIsResting(true);
                    } else {
                        setIsResting(false);
                    }
                };
                
                const handleRestComplete = () => {
                    setIsResting(false);
                    setCurrentSet(currentSet + 1);
                    if (exercise.type === 'time') {
                        setTimeLeft(exercise.repsOrTime);
                        setIsTimerRunning(false);
                    }
                };
                
                const handleDifficultySelect = (level) => {
                    setDifficulty(level);
                    onComplete(level);
                };
                
                if (difficulty === null && currentSet === exercise.sets && !isResting) {
                    return (
                        <div className="h-full flex flex-col items-center justify-center p-6">
                            <h3 className="text-2xl font-bold mb-8">Wie war die Übung?</h3>
                            <div className="grid grid-cols-2 gap-4 w-full max-w-sm">
                                <button
                                    onClick={() => handleDifficultySelect('easy')}
                                    className="bg-green-600 p-6 rounded-lg text-lg font-medium transition-opacity active:opacity-80"
                                >
                                    Easy
                                </button>
                                <button
                                    onClick={() => handleDifficultySelect('moderate')}
                                    className="bg-yellow-600 p-6 rounded-lg text-lg font-medium transition-opacity active:opacity-80"
                                >
                                    Moderate
                                </button>
                                <button
                                    onClick={() => handleDifficultySelect('hard')}
                                    className="bg-orange-600 p-6 rounded-lg text-lg font-medium transition-opacity active:opacity-80"
                                >
                                    Hard
                                </button>
                                <button
                                    onClick={() => handleDifficultySelect('very hard')}
                                    className="bg-red-600 p-6 rounded-lg text-lg font-medium transition-opacity active:opacity-80"
                                >
                                    Very Hard
                                </button>
                            </div>
                        </div>
                    );
                }
                
                return (
                    <div className="h-full flex flex-col">
                        <div className="flex items-center gap-4 p-4 bg-gray-800">
                            <button onClick={onBack} className="text-gray-400 transition-opacity active:opacity-60">
                                <ArrowLeft />
                            </button>
                            <h2 className="text-xl font-bold flex-1">{exercise.name}</h2>
                        </div>
                        
                        <div className="flex-1 flex flex-col items-center justify-center p-6">
                            {isResting ? (
                                <>
                                    <h3 className="text-2xl mb-8">Pause</h3>
                                    <Timer duration={exercise.restTime} onComplete={handleRestComplete} />
                                </>
                            ) : (
                                <>
                                    <div className="text-center mb-8">
                                        <h3 className="text-4xl font-bold mb-2">Satz {currentSet} / {exercise.sets}</h3>
                                        <p className="text-xl text-gray-400">
                                            {exercise.type === 'reps' ? `${exercise.repsOrTime} Wiederholungen` : `${exercise.repsOrTime} Sekunden`}
                                        </p>
                                    </div>
                                    
                                    {exercise.type === 'time' ? (
                                        <div className="text-center">
                                            <div className="text-6xl font-mono mb-8 timer-display">
                                                {Math.floor(timeLeft / 60)}:{(timeLeft % 60).toString().padStart(2, '0')}
                                            </div>
                                            <button
                                                onClick={() => setIsTimerRunning(!isTimerRunning)}
                                                className="bg-blue-600 p-6 rounded-full transition-opacity active:opacity-80"
                                            >
                                                {isTimerRunning ? <Pause size={32} /> : <Play size={32} />}
                                            </button>
                                        </div>
                                    ) : (
                                        <button
                                            onClick={handleSetComplete}
                                            className="bg-green-600 p-6 rounded-full transition-opacity active:opacity-80"
                                        >
                                            <Check size={32} />
                                        </button>
                                    )}
                                </>
                            )}
                        </div>
                    </div>
                );
            };
            
            // Session Execution View  
            const SessionExecution = ({ session, onComplete }) => {
                const [exerciseOrder, setExerciseOrder] = useState(session.exercises);
                const [currentExerciseIndex, setCurrentExerciseIndex] = useState(null);
                const [completedExercises, setCompletedExercises] = useState([]);
                const [showExerciseSelector, setShowExerciseSelector] = useState(false);
                const [replacingIndex, setReplacingIndex] = useState(null);
                
                const handleExerciseComplete = (difficulty) => {
                    const exerciseId = exerciseOrder[currentExerciseIndex];
                    setCompletedExercises([...completedExercises, { exerciseId, difficulty }]);
                    setCurrentExerciseIndex(null);
                };
                
                const handleReplaceExercise = (newExerciseId) => {
                    const newOrder = [...exerciseOrder];
                    newOrder[replacingIndex] = newExerciseId;
                    setExerciseOrder(newOrder);
                    setShowExerciseSelector(false);
                    setReplacingIndex(null);
                };
                
                const handleAddStretchExercise = () => {
                    const stretchExercise = {
                        id: 'stretch-' + generateId(),
                        name: 'Dehnübung',
                        type: 'time',
                        sets: 2,
                        repsOrTime: 30,
                        restTime: 5
                    };
                    setExercises([...exercises, stretchExercise]);
                    setExerciseOrder([...exerciseOrder, stretchExercise.id]);
                };
                
                const moveExercise = (fromIndex, toIndex) => {
                    const newOrder = [...exerciseOrder];
                    const [moved] = newOrder.splice(fromIndex, 1);
                    newOrder.splice(toIndex, 0, moved);
                    setExerciseOrder(newOrder);
                };
                
                if (currentExerciseIndex !== null) {
                    const exercise = exercises.find(e => e.id === exerciseOrder[currentExerciseIndex]);
                    return (
                        <ExerciseExecution
                            exercise={exercise}
                            onComplete={handleExerciseComplete}
                            onBack={() => setCurrentExerciseIndex(null)}
                        />
                    );
                }
                
                if (showExerciseSelector) {
                    return (
                        <div className="h-full flex flex-col">
                            <div className="flex items-center gap-4 p-4 bg-gray-800">
                                <button onClick={() => setShowExerciseSelector(false)} className="text-gray-400 transition-opacity active:opacity-60">
                                    <ArrowLeft />
                                </button>
                                <h2 className="text-xl font-bold">Übung auswählen</h2>
                            </div>
                            
                            <div className="flex-1 overflow-y-auto p-4 space-y-2">
                                {exercises.map(exercise => (
                                    <button
                                        key={exercise.id}
                                        onClick={() => handleReplaceExercise(exercise.id)}
                                        className="w-full p-4 bg-gray-800 rounded-lg text-left transition-colors hover:bg-gray-700"
                                    >
                                        <h3 className="font-medium">{exercise.name}</h3>
                                        <p className="text-sm text-gray-400">
                                            {exercise.sets} × {exercise.repsOrTime} {exercise.type === 'reps' ? 'Wdh' : 'Sek'}
                                        </p>
                                    </button>
                                ))}
                            </div>
                        </div>
                    );
                }
                
                return (
                    <div className="h-full flex flex-col">
                        <div className="flex items-center gap-4 p-4 bg-gray-800">
                            <h2 className="text-xl font-bold">{session.name}</h2>
                            <span className="text-sm text-gray-400">{session.trainingType}</span>
                        </div>
                        
                        <div className="flex-1 overflow-y-auto p-4 space-y-2">
                            {exerciseOrder.map((exerciseId, index) => {
                                const exercise = exercises.find(e => e.id === exerciseId);
                                const isCompleted = completedExercises.some(c => c.exerciseId === exerciseId);
                                
                                return (
                                    <div
                                        key={index}
                                        className={`bg-gray-800 p-4 rounded-lg transition-opacity ${isCompleted ? 'opacity-50' : ''}`}
                                    >
                                        <div className="flex items-center gap-3">
                                            <button
                                                onClick={() => index > 0 && moveExercise(index, index - 1)}
                                                className="text-gray-500 text-xl transition-opacity active:opacity-60"
                                                disabled={index === 0}
                                            >
                                                ↑
                                            </button>
                                            <button
                                                onClick={() => index < exerciseOrder.length - 1 && moveExercise(index, index + 1)}
                                                className="text-gray-500 text-xl transition-opacity active:opacity-60"
                                                disabled={index === exerciseOrder.length - 1}
                                            >
                                                ↓
                                            </button>
                                            
                                            <div className="flex-1">
                                                <h3 className="font-medium">{exercise?.name || 'Unbekannte Übung'}</h3>
                                                <p className="text-sm text-gray-400">
                                                    {exercise?.sets} × {exercise?.repsOrTime} {exercise?.type === 'reps' ? 'Wdh' : 'Sek'}
                                                </p>
                                            </div>
                                            
                                            <button
                                                onClick={() => {
                                                    setReplacingIndex(index);
                                                    setShowExerciseSelector(true);
                                                }}
                                                className="text-blue-400 transition-opacity active:opacity-60"
                                            >
                                                <RefreshCw />
                                            </button>
                                            
                                            {!isCompleted && (
                                                <button
                                                    onClick={() => setCurrentExerciseIndex(index)}
                                                    className="bg-blue-600 p-2 rounded transition-opacity active:opacity-80"
                                                >
                                                    <Play size={20} />
                                                </button>
                                            )}
                                            
                                            {isCompleted && <Check className="text-green-500" size={20} />}
                                        </div>
                                    </div>
                                );
                            })}
                            
                            <button
                                onClick={handleAddStretchExercise}
                                className="w-full p-4 bg-gray-700 rounded-lg text-center transition-opacity active:opacity-80"
                            >
                                <Plus /> Dehnübung hinzufügen
                            </button>
                        </div>
                        
                        <div className="p-4">
                            <button
                                onClick={() => {
                                    const history = {
                                        id: generateId(),
                                        sessionId: session.id,
                                        date: new Date().toISOString(),
                                        exercises: completedExercises
                                    };
                                    setSessionHistory([...sessionHistory, history]);
                                    onComplete();
                                }}
                                className="w-full bg-green-600 p-4 rounded-lg font-medium transition-opacity active:opacity-80"
                                disabled={completedExercises.length === 0}
                            >
                                Training beenden
                            </button>
                        </div>
                    </div>
                );
            };
            
            // Training Plan View
            const TrainingPlanView = () => {
                const [draggedIndex, setDraggedIndex] = useState(null);
                
                const handleDragStart = (index) => {
                    setDraggedIndex(index);
                };
                
                const handleDragOver = (e) => {
                    e.preventDefault();
                };
                
                const handleDrop = (e, dropIndex) => {
                    e.preventDefault();
                    if (draggedIndex === null) return;
                    
                    const newPlan = [...trainingPlan];
                    const [draggedItem] = newPlan.splice(draggedIndex, 1);
                    newPlan.splice(dropIndex, 0, draggedItem);
                    setTrainingPlan(newPlan);
                    setDraggedIndex(null);
                };
                
                const addToPlan = (sessionId) => {
                    setTrainingPlan([...trainingPlan, sessionId]);
                };
                
                const removeFromPlan = (index) => {
                    setTrainingPlan(trainingPlan.filter((_, i) => i !== index));
                };
                
                return (
                    <div className="pb-20">
                        <h2 className="text-2xl font-bold mb-6">Trainingsplan</h2>
                        
                        <div className="mb-6">
                            <h3 className="text-lg font-medium mb-3">Plan-Reihenfolge:</h3>
                            {trainingPlan.length === 0 ? (
                                <p className="text-gray-400">Noch keine Einheiten im Plan</p>
                            ) : (
                                <div className="space-y-2">
                                    {trainingPlan.map((sessionId, index) => {
                                        const session = sessions.find(s => s.id === sessionId);
                                        if (!session) return null;
                                        
                                        return (
                                            <div
                                                key={index}
                                                draggable
                                                onDragStart={() => handleDragStart(index)}
                                                onDragOver={handleDragOver}
                                                onDrop={(e) => handleDrop(e, index)}
                                                className="bg-gray-800 p-4 rounded-lg flex items-center gap-3 cursor-move"
                                            >
                                                <span className="text-gray-500 text-xl">☰</span>
                                                <div className="flex-1">
                                                    <h4 className="font-medium">{session.name}</h4>
                                                    <p className="text-sm text-gray-400">{session.trainingType}</p>
                                                </div>
                                                <button
                                                    onClick={() => removeFromPlan(index)}
                                                    className="text-red-400 transition-opacity active:opacity-60"
                                                >
                                                    <X size={20} />
                                                </button>
                                            </div>
                                        );
                                    })}
                                </div>
                            )}
                        </div>
                        
                        <div>
                            <h3 className="text-lg font-medium mb-3">Verfügbare Einheiten:</h3>
                            <div className="space-y-2">
                                {sessions.map(session => (
                                    <div key={session.id} className="bg-gray-700 p-3 rounded-lg flex justify-between items-center">
                                        <span>{session.name}</span>
                                        <button
                                            onClick={() => addToPlan(session.id)}
                                            className="bg-blue-600 p-2 rounded transition-opacity active:opacity-80"
                                        >
                                            <Plus size={16} />
                                        </button>
                                    </div>
                                ))}
                                
                                {sessions.length === 0 && (
                                    <p className="text-center text-gray-500 py-4">Erstelle zuerst Trainingseinheiten</p>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };
            
            // Settings View
            const SettingsView = () => {
                const [newType, setNewType] = useState('');
                
                const addTrainingType = () => {
                    if (newType && !trainingTypes.includes(newType)) {
                        setTrainingTypes([...trainingTypes, newType]);
                        setNewType('');
                    }
                };
                
                const removeTrainingType = (type) => {
                    if (!DEFAULT_TRAINING_TYPES.includes(type)) {
                        setTrainingTypes(trainingTypes.filter(t => t !== type));
                    }
                };
                
                return (
                    <div className="pb-20">
                        <h2 className="text-2xl font-bold mb-6">Einstellungen</h2>
                        
                        <div className="bg-gray-800 p-4 rounded-lg">
                            <h3 className="text-lg font-medium mb-4">Trainingstypen</h3>
                            
                            <div className="flex gap-2 mb-4">
                                <input
                                    type="text"
                                    placeholder="Neuer Trainingstyp"
                                    value={newType}
                                    onChange={(e) => setNewType(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && addTrainingType()}
                                    className="flex-1 p-2 bg-gray-700 rounded text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                />
                                <button
                                    onClick={addTrainingType}
                                    className="bg-blue-600 p-2 rounded transition-opacity active:opacity-80"
                                >
                                    <Plus size={20} />
                                </button>
                            </div>
                            
                            <div className="space-y-2">
                                {trainingTypes.map(type => (
                                    <div key={type} className="flex justify-between items-center p-2 bg-gray-700 rounded">
                                        <span>{type}</span>
                                        {!DEFAULT_TRAINING_TYPES.includes(type) && (
                                            <button
                                                onClick={() => removeTrainingType(type)}
                                                className="text-red-400 transition-opacity active:opacity-60"
                                            >
                                                <X size={16} />
                                            </button>
                                        )}
                                    </div>
                                ))}
                            </div>
                        </div>
                        
                        <div className="mt-6 bg-gray-800 p-4 rounded-lg">
                            <h3 className="text-lg font-medium mb-2">App Info</h3>
                            <p className="text-sm text-gray-400">Version 1.0.0</p>
                            <p className="text-sm text-gray-400">Daten werden lokal gespeichert</p>
                        </div>
                    </div>
                );
            };
            
            // Home View
            const HomeView = () => {
                const getNextSessionIndex = () => {
                    if (trainingPlan.length === 0) return -1;
                    
                    const lastCompleted = sessionHistory
                        .filter(h => trainingPlan.includes(h.sessionId))
                        .sort((a, b) => new Date(b.date) - new Date(a.date))[0];
                    
                    if (!lastCompleted) return 0;
                    
                    const lastIndex = trainingPlan.indexOf(lastCompleted.sessionId);
                    return (lastIndex + 1) % trainingPlan.length;
                };
                
                const nextIndex = getNextSessionIndex();
                
                const moveSession = (fromIndex, toIndex) => {
                    const newPlan = [...trainingPlan];
                    const [moved] = newPlan.splice(fromIndex, 1);
                    newPlan.splice(toIndex, 0, moved);
                    setTrainingPlan(newPlan);
                };
                
                if (activeSession) {
                    return (
                        <SessionExecution
                            session={activeSession}
                            onComplete={() => {
                                setActiveSession(null);
                                setCurrentView('home');
                            }}
                        />
                    );
                }
                
                return (
                    <div className="pb-20">
                        <h1 className="text-3xl font-bold mb-6">Training Tracker</h1>
                        
                        {trainingPlan.length === 0 ? (
                            <div className="text-center py-12">
                                <p className="text-gray-400 mb-4">Noch kein Trainingsplan erstellt</p>
                                <button
                                    onClick={() => setCurrentView('plan')}
                                    className="bg-blue-600 px-6 py-3 rounded-lg transition-opacity active:opacity-80"
                                >
                                    Plan erstellen
                                </button>
                            </div>
                        ) : (
                            <div className="space-y-2">
                                {trainingPlan.map((sessionId, index) => {
                                    const session = sessions.find(s => s.id === sessionId);
                                    if (!session) return null;
                                    
                                    const isNext = index === nextIndex;
                                    
                                    return (
                                        <div
                                            key={index}
                                            className={`bg-gray-800 p-4 rounded-lg ${isNext ? 'ring-2 ring-blue-500' : ''}`}
                                        >
                                            <div className="flex items-center gap-3">
                                                <button
                                                    onClick={() => index > 0 && moveSession(index, index - 1)}
                                                    className="text-gray-500 text-xl transition-opacity active:opacity-60"
                                                    disabled={index === 0}
                                                >
                                                    ↑
                                                </button>
                                                <button
                                                    onClick={() => index < trainingPlan.length - 1 && moveSession(index, index + 1)}
                                                    className="text-gray-500 text-xl transition-opacity active:opacity-60"
                                                    disabled={index === trainingPlan.length - 1}
                                                >
                                                    ↓
                                                </button>
                                                
                                                <div className="flex-1">
                                                    <h3 className="font-medium">{session.name}</h3>
                                                    <p className="text-sm text-gray-400">
                                                        {session.trainingType} • {session.exercises.length} Übungen
                                                        {isNext && <span className="text-blue-400 ml-2">← Als nächstes</span>}
                                                    </p>
                                                </div>
                                                
                                                <button
                                                    onClick={() => setActiveSession(session)}
                                                    className="bg-blue-600 px-4 py-2 rounded-lg transition-opacity active:opacity-80"
                                                >
                                                    Start
                                                </button>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        )}
                        
                        <div className="mt-8">
                            <h2 className="text-xl font-bold mb-4">Letzte Trainings</h2>
                            {sessionHistory.length === 0 ? (
                                <p className="text-gray-400 text-sm">Noch keine Trainings absolviert</p>
                            ) : (
                                sessionHistory.slice(-5).reverse().map(history => {
                                    const session = sessions.find(s => s.id === history.sessionId);
                                    return (
                                        <div key={history.id} className="bg-gray-800 p-3 rounded mb-2">
                                            <p className="font-medium">{session?.name || 'Unbekannte Einheit'}</p>
                                            <p className="text-sm text-gray-400">
                                                {new Date(history.date).toLocaleDateString('de-DE')}
                                            </p>
                                        </div>
                                    );
                                })
                            )}
                        </div>
                    </div>
                );
            };
            
            // Main render
            return (
                <div className="min-h-screen bg-gray-900 text-white">
                    <div className="max-w-lg mx-auto p-4" style={{paddingBottom: '80px'}}>
                        {currentView === 'home' && <HomeView />}
                        {currentView === 'exercises' && <ExercisesView />}
                        {currentView === 'sessions' && <SessionsView />}
                        {currentView === 'plan' && <TrainingPlanView />}
                        {currentView === 'settings' && <SettingsView />}
                    </div>
                    {!activeSession && <Navigation />}
                </div>
            );
        };
        
        // Render the app
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
